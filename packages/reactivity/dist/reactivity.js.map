{
  "version": 3,
  "sources": ["../../shared/src/index.ts", "../src/effect.ts", "../src/reactiveEffect.ts", "../src/baseHandler.ts", "../src/reactive.ts"],
  "sourcesContent": ["export function isObject(value) {\n    return value !== null && typeof value === 'object';\n}", "/**\n * \u5F53\u524D\u3010\u6FC0\u6D3B\u7684/\u6B63\u88AB\u6267\u884C\u7684\u3011effect\n */\nexport let activeEffect;\n\n\n/**\n * \u521B\u5EFA\u54CD\u5E94\u5F0F\u7684effect\uFF0C\u6570\u636E\u53D8\u5316\u65F6\u53EF\u4EE5\u91CD\u65B0\u6267\u884C\n * @param fn\n * @param options\n */\nexport function effect(fn, options = {}) {\n  const _effect = new ReactiveEffect(fn, () => {\n    _effect.run();\n  });\n\n  // effect\u5B9E\u4F8B\u521B\u5EFA\u5B8C\u6BD5\u4E4B\u540E\uFF0C\u4F1A\u7ACB\u523B\u6267\u884C\u4E00\u6B21\n  _effect.run();\n}\n\n\nexport class ReactiveEffect {\n  /**\n   * \u8BB0\u5F55\u5F53\u524Deffect\u6267\u884C\u7684\u6B21\u6570\n   */\n  _trackId = 0;\n\n  /**\n   * \u6536\u96C6\u5F53\u524Deffect\u7684deps\u4E2A\u6570\n   */\n  _depsLength = 0;\n\n  /**\n   * \u6536\u96C6\u5F53\u524Deffect\u7684deps\u6570\u7EC4\n   */\n  deps = [];\n\n  /**\n   * \u5F53\u524Deffect\u662F\u5426\u4E3A\u54CD\u5E94\u5F0F\u7684\n   */\n  public active = true;\n\n  /**\n   * \u6784\u9020\u51FD\u6570\n   * @param fn \u7528\u6237\u81EA\u5B9A\u4E49\u56DE\u8C03\u51FD\u6570\n   * @param scheduler\n   */\n  constructor(public fn, public scheduler) {\n    // noop\n  }\n\n  run() {\n    if (!this.active) {\n      return this.fn();\n    }\n\n    // \u8BB0\u5F55\u4E0A\u6B21\u6267\u884C\u7684effect\uFF0C\u89E3\u51B3effect\u7236\u5B50\u5D4C\u5957\u95EE\u9898\n    const lastActiveEffect = activeEffect;\n\n    try {\n      activeEffect = this;\n      return this.fn(); // \u6267\u884Cfn\u4F1A\u89E6\u53D1\u4F9D\u8D56\u6536\u96C6\n    } finally {\n      activeEffect = lastActiveEffect;\n    }\n  }\n\n}\n\nexport function trackEffect(effect, dep) {\n  // dep\u6536\u96C6effect\n  dep.set(effect, effect._trackId);\n\n  // effect \u548C dep \u53CC\u5411\u8BB0\u5FC6\n  effect[effect._depsLength++] = dep;\n}\n", "import { activeEffect, trackEffect } from './effect';\n\n/**\n * \u4F9D\u8D56\u6536\u96C6Mapping\n */\nconst targetMap = new WeakMap();\n\n/**\n * \u521B\u5EFA\u4E00\u4E2Adep\uFF0C\u5E76\u4E14\u5728\u8BE5dep\u4E0A\u589E\u52A0\u6307\u5B9A\u5C5E\u6027\n * @param clearup dep\u6E05\u7406\u903B\u8F91\n * @param key \u6B64\u53C2\u6570\u4EC5\u4F5C\u8C03\u8BD5\n */\nfunction createDep(clearup, key) {\n  const dep = new Map() as any;\n  dep.clearup = clearup;\n  dep.key = key;\n  return dep;\n}\n\n/**\n * \u4F9D\u8D56\u6536\u96C6\n * @param target \u76EE\u6807\u5BF9\u8C61\n * @param key \u5C5E\u6027key\n */\nexport function track(target, key) {\n  if (activeEffect) {\n\n    /**\n     * \u6784\u5EFA\u4F9D\u8D56\u6620\u5C04\u8868\n     */\n    let depsMap = targetMap.get(target);\n    if (!depsMap) {\n      targetMap.set(target, (depsMap = new Map()));\n    }\n    let dep = depsMap.get(key);\n    if (!dep) {\n      depsMap.set(\n        key,\n        (dep = createDep(() => depsMap.delete(key), key)) // \u7528\u4E8E\u6E05\u7406target\u4E0A\u4E0D\u9700\u8981\u7684\u5C5E\u6027\n      );\n    }\n\n    /*\n    * \u4F9D\u8D56\u6536\u96C6\n    * \u5C06\u5F53\u524D\u7684effect\u52A0\u5165\u5230dep\u4E2D\n    */\n    trackEffect(activeEffect, dep);\n\n    console.log(targetMap);\n  }\n}\n\n/**\n targetMap[WeakMap]: { targetObj: { \u5C5E\u6027prop: { effect, effect, ... } } }\n\n {\n    { name: 'cuimm', age: 18}: { -- depsMap\n      cuimm: {\n        effect1,\n        effect2,\n        ...\n      },\n      age: {\n        effect1,\n        effect3,\n        ...\n      }\n    },\n    { name: 'cui' }: {\n      'cui': { ... }\n    }\n}\n */", "import { ReactiveFlags } from './constants';\nimport { track } from './reactiveEffect';\n/**\n * ProxyHandler\n */\nexport const mutableHandlers: ProxyHandler<any> = {\n  get(target, key, receiver) {\n    if (key === ReactiveFlags.IS_REACTIVE) {\n      return true;\n    }\n\n    // \u4F9D\u8D56\u6536\u96C6\n    track(target, key);\n\n    return Reflect.get(target, key, receiver);\n  },\n  set(target, key, value, receiver) {\n\n    // \u89E6\u53D1\u66F4\u65B0 todo...\n\n    return Reflect.set(target, key, value, receiver);\n  }\n};", "import { isObject } from '@vue/shared';\nimport { ReactiveFlags } from './constants';\nimport { mutableHandlers } from './baseHandler';\n\n/**\n * \u7528\u4E8E\u8BB0\u5F55\u539F\u59CB\u5BF9\u8C61\u548C\u54CD\u5E94\u5F0F\u5BF9\u8C61\n */\nconst reactiveMap = new WeakMap();\n\n/**\n * \u521B\u5EFA\u54CD\u5E94\u5F0F\u5BF9\u8C61\n * @param target \u76EE\u6807\u5BF9\u8C61\n */\nfunction createReactiveObject(target) {\n  // \u54CD\u5E94\u5F0F\u6570\u636E\u5FC5\u987B\u662F\u5BF9\u8C61\n  if (!isObject(target)) {\n    return target;\n  }\n\n  // \u88AB\u4EE3\u7406\u8FC7\u7684proxy\u5BF9\u8C61\u4F1A\u6709get\u548Cset\u65B9\u6CD5\uFF0Ctarget\u5982\u679C\u5DF2\u7ECF\u88AB\u4EE3\u7406\u8FC7\u4E86\uFF0C\u4F1A\u6267\u884Cget\u8FD4\u56DEtrue\n  if (target[ReactiveFlags.IS_REACTIVE]) {\n    return target;\n  }\n\n  // \u5DF2\u7ECF\u4EE3\u7406\u8FC7\u7684\u5BF9\u8C61\u4E0D\u518D\u91CD\u65B0\u4EE3\u7406\n  const existProxy = reactiveMap.get(target);\n  if (existProxy) {\n    return existProxy;\n  }\n\n  const proxy = new Proxy(target, mutableHandlers);\n\n  // \u7F13\u5B58\u4EE3\u7406\u540E\u7684\u7ED3\u679C\n  reactiveMap.set(target, proxy);\n\n  return proxy;\n}\n\n/**\n * \u521B\u5EFA\u54CD\u5E94\u5F0F\u5BF9\u8C61\n * @param target \u76EE\u6807\u5BF9\u8C61\n */\nexport function reactive(target) {\n  return createReactiveObject(target);\n}"],
  "mappings": ";AAAO,SAAS,SAAS,OAAO;AAC5B,SAAO,UAAU,QAAQ,OAAO,UAAU;AAC9C;;;ACCO,IAAI;AAQJ,SAAS,OAAO,IAAI,UAAU,CAAC,GAAG;AACvC,QAAM,UAAU,IAAI,eAAe,IAAI,MAAM;AAC3C,YAAQ,IAAI;AAAA,EACd,CAAC;AAGD,UAAQ,IAAI;AACd;AAGO,IAAM,iBAAN,MAAqB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EA0B1B,YAAmB,IAAW,WAAW;AAAtB;AAAW;AAtB9B;AAAA;AAAA;AAAA,oBAAW;AAKX;AAAA;AAAA;AAAA,uBAAc;AAKd;AAAA;AAAA;AAAA,gBAAO,CAAC;AAKR;AAAA;AAAA;AAAA,SAAO,SAAS;AAAA,EAShB;AAAA,EAEA,MAAM;AACJ,QAAI,CAAC,KAAK,QAAQ;AAChB,aAAO,KAAK,GAAG;AAAA,IACjB;AAGA,UAAM,mBAAmB;AAEzB,QAAI;AACF,qBAAe;AACf,aAAO,KAAK,GAAG;AAAA,IACjB,UAAE;AACA,qBAAe;AAAA,IACjB;AAAA,EACF;AAEF;AAEO,SAAS,YAAYA,SAAQ,KAAK;AAEvC,MAAI,IAAIA,SAAQA,QAAO,QAAQ;AAG/B,EAAAA,QAAOA,QAAO,aAAa,IAAI;AACjC;;;ACtEA,IAAM,YAAY,oBAAI,QAAQ;AAO9B,SAAS,UAAU,SAAS,KAAK;AAC/B,QAAM,MAAM,oBAAI,IAAI;AACpB,MAAI,UAAU;AACd,MAAI,MAAM;AACV,SAAO;AACT;AAOO,SAAS,MAAM,QAAQ,KAAK;AACjC,MAAI,cAAc;AAKhB,QAAI,UAAU,UAAU,IAAI,MAAM;AAClC,QAAI,CAAC,SAAS;AACZ,gBAAU,IAAI,QAAS,UAAU,oBAAI,IAAI,CAAE;AAAA,IAC7C;AACA,QAAI,MAAM,QAAQ,IAAI,GAAG;AACzB,QAAI,CAAC,KAAK;AACR,cAAQ;AAAA,QACN;AAAA,QACC,MAAM,UAAU,MAAM,QAAQ,OAAO,GAAG,GAAG,GAAG;AAAA;AAAA,MACjD;AAAA,IACF;AAMA,gBAAY,cAAc,GAAG;AAE7B,YAAQ,IAAI,SAAS;AAAA,EACvB;AACF;;;AC7CO,IAAM,kBAAqC;AAAA,EAChD,IAAI,QAAQ,KAAK,UAAU;AACzB,QAAI,4CAAmC;AACrC,aAAO;AAAA,IACT;AAGA,UAAM,QAAQ,GAAG;AAEjB,WAAO,QAAQ,IAAI,QAAQ,KAAK,QAAQ;AAAA,EAC1C;AAAA,EACA,IAAI,QAAQ,KAAK,OAAO,UAAU;AAIhC,WAAO,QAAQ,IAAI,QAAQ,KAAK,OAAO,QAAQ;AAAA,EACjD;AACF;;;ACfA,IAAM,cAAc,oBAAI,QAAQ;AAMhC,SAAS,qBAAqB,QAAQ;AAEpC,MAAI,CAAC,SAAS,MAAM,GAAG;AACrB,WAAO;AAAA,EACT;AAGA,MAAI,yCAAgC,GAAG;AACrC,WAAO;AAAA,EACT;AAGA,QAAM,aAAa,YAAY,IAAI,MAAM;AACzC,MAAI,YAAY;AACd,WAAO;AAAA,EACT;AAEA,QAAM,QAAQ,IAAI,MAAM,QAAQ,eAAe;AAG/C,cAAY,IAAI,QAAQ,KAAK;AAE7B,SAAO;AACT;AAMO,SAAS,SAAS,QAAQ;AAC/B,SAAO,qBAAqB,MAAM;AACpC;",
  "names": ["effect"]
}
